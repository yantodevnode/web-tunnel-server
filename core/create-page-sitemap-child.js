const dir = process.cwd();
const config = require(dir+"/config.json");

module.exports = async (data,url)=>{
  const pathname = url.pathname;
  const fileName =  await pathname.replace(config["path-sitemap-urlset"],"").replace(".xml","");
  let sendBack=`<?xml version="1.0" encoding="UTF-8"?><?xml-stylesheet type="text/xsl" href="`+url.origin+`/main-sitemap.xsl"?>
<urlset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:image="http://www.google.com/schemas/sitemap-image/1.1" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd http://www.google.com/schemas/sitemap-image/1.1 http://www.google.com/schemas/sitemap-image/1.1/sitemap-image.xsd" xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
`;
  for(let path of data){
    sendBack+=`  <url>
`;
    const uri = url.origin+config["path-content-post-start"]+fileName+config["path-content-post-end"]+path.name;
    const timeCreate = Number(path.time)*1000;
    sendBack+=`    <loc>`+uri+`</loc>
`;
    sendBack+=`    <lastmod>`+new Date(timeCreate).toISOString()+`</lastmod>
`;
    sendBack+=`  </url>
`;
  };
  sendBack+=`</urlset>
<!-- XML Sitemap generated by NodeJs -->`;
  return sendBack;
};